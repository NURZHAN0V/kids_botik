import random
import time
from typing import Tuple, List, Set, Optional

def —Å–æ–∑–¥–∞—Ç—å_–∏–≥—Ä—É_—Ç—Ä–∏_–≤_—Ä—è–¥(user_id):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä—ã —Ç—Ä–∏ –≤ —Ä—è–¥"""
    # –ü–æ–ª–µ 8x8 —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ (–∫—Ä–∞—Å–æ—á–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã)
    —Å–∏–º–≤–æ–ª—ã = ["üçé", "üçä", "üçá", "üçì", "üçí", "üçë"]
    –ø–æ–ª–µ = []
    
    # –°–æ–∑–¥–∞—ë–º –ø–æ–ª–µ –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    for i in range(8):
        —Å—Ç—Ä–æ–∫–∞ = []
        for j in range(8):
            # –í—ã–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª, –∏–∑–±–µ–≥–∞—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            –¥–æ—Å—Ç—É–ø–Ω—ã–µ = —Å–∏–º–≤–æ–ª—ã.copy()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å (2 –Ω–∞–∑–∞–¥)
            if j >= 2 and —Å—Ç—Ä–æ–∫–∞[j-1] == —Å—Ç—Ä–æ–∫–∞[j-2]:
                if —Å—Ç—Ä–æ–∫–∞[j-1] in –¥–æ—Å—Ç—É–ø–Ω—ã–µ:
                    –¥–æ—Å—Ç—É–ø–Ω—ã–µ.remove(—Å—Ç—Ä–æ–∫–∞[j-1])
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å (2 –Ω–∞–∑–∞–¥)
            if i >= 2 and –ø–æ–ª–µ[i-1][j] == –ø–æ–ª–µ[i-2][j]:
                if –ø–æ–ª–µ[i-1][j] in –¥–æ—Å—Ç—É–ø–Ω—ã–µ:
                    –¥–æ—Å—Ç—É–ø–Ω—ã–µ.remove(–ø–æ–ª–µ[i-1][j])
            
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
            —Å–∏–º–≤–æ–ª = random.choice(–¥–æ—Å—Ç—É–ø–Ω—ã–µ)
            —Å—Ç—Ä–æ–∫–∞.append(—Å–∏–º–≤–æ–ª)
        –ø–æ–ª–µ.append(—Å—Ç—Ä–æ–∫–∞)
    
    return {
        '–ø–æ–ª–µ': –ø–æ–ª–µ,
        '—Å—á—ë—Ç': 0,
        '—Ö–æ–¥—ã': 0,
        '–≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞': None,
        '–≤—Ä–µ–º—è_–Ω–∞—á–∞–ª–∞': time.time(),
        '–ª—É—á—à–∏–π_—Å—á—ë—Ç': 0,
        '–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ': 0,
        '—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ': 0,
        '–æ–±—â–µ–µ_–≤—Ä–µ–º—è': 0
    }

def —Å–æ–∑–¥–∞—Ç—å_–∫–Ω–æ–ø–∫–∏_—Ç—Ä–∏_–≤_—Ä—è–¥(–ø–æ–ª–µ, –≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞=None):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è —Ç—Ä–∏ –≤ —Ä—è–¥ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ä–∞–∑–º–µ—Ä–æ–º"""
    import telebot
    markup = telebot.types.InlineKeyboardMarkup(row_width=8)
    
    for i in range(8):
        row = []
        for j in range(8):
            —Å–∏–º–≤–æ–ª = –ø–æ–ª–µ[i][j]
            
            # –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏
            if –≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞ and (i, j) == –≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞:
                text = "‚Ä¢"  # –ú–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            else:
                text = —Å–∏–º–≤–æ–ª
            
            # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π
            button = telebot.types.InlineKeyboardButton(text, callback_data=f"match_{i}_{j}")
            row.append(button)
        markup.row(*row)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    control_row = []
    control_row.append(telebot.types.InlineKeyboardButton("üîÑ –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä", callback_data="match_cancel"))
    control_row.append(telebot.types.InlineKeyboardButton("‚èπÔ∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É", callback_data="match_end"))
    markup.row(*control_row)
    
    return markup

def –Ω–∞–π—Ç–∏_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ) -> Set[Tuple[int, int]]:
    """–ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ –ø–æ–ª–µ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π"""
    —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è = set()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (3 –∏ –±–æ–ª–µ–µ)
    for i in range(8):
        j = 0
        while j < 6:  # –î–æ 6, —á—Ç–æ–±—ã –ø–æ–º–µ—Å—Ç–∏–ª–∏—Å—å 3 —Å–∏–º–≤–æ–ª–∞
            if –ø–æ–ª–µ[i][j] == –ø–æ–ª–µ[i][j+1] == –ø–æ–ª–µ[i][j+2]:
                # –ò—â–µ–º –∫–æ–Ω–µ—Ü —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                end_j = j + 2
                while end_j < 7 and –ø–æ–ª–µ[i][end_j] == –ø–æ–ª–µ[i][end_j+1]:
                    end_j += 1
                
                # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å–æ–≤–ø–∞–≤—à–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                for k in range(j, end_j + 1):
                    —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.add((i, k))
                j = end_j + 1
            else:
                j += 1
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (3 –∏ –±–æ–ª–µ–µ)
    for j in range(8):
        i = 0
        while i < 6:  # –î–æ 6, —á—Ç–æ–±—ã –ø–æ–º–µ—Å—Ç–∏–ª–∏—Å—å 3 —Å–∏–º–≤–æ–ª–∞
            if –ø–æ–ª–µ[i][j] == –ø–æ–ª–µ[i+1][j] == –ø–æ–ª–µ[i+2][j]:
                # –ò—â–µ–º –∫–æ–Ω–µ—Ü —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                end_i = i + 2
                while end_i < 7 and –ø–æ–ª–µ[end_i][j] == –ø–æ–ª–µ[end_i+1][j]:
                    end_i += 1
                
                # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å–æ–≤–ø–∞–≤—à–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                for k in range(i, end_i + 1):
                    —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.add((k, j))
                i = end_i + 1
            else:
                i += 1
    
    return —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

def —É–¥–∞–ª–∏—Ç—å_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ, —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è):
    """–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏ –ø–∞–¥–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤"""
    —Å–∏–º–≤–æ–ª—ã = ["üçé", "üçä", "üçá", "üçì", "üçí", "üçë"]
    
    # –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–≤—à–∏–µ —Å–∏–º–≤–æ–ª—ã
    for i, j in —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
        –ø–æ–ª–µ[i][j] = None
    
    # –ü–∞–¥–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤
    for j in range(8):
        # –°–¥–≤–∏–≥–∞–µ–º —Å–∏–º–≤–æ–ª—ã –≤–Ω–∏–∑
        –∫–æ–ª–æ–Ω–∫–∞ = [–ø–æ–ª–µ[i][j] for i in range(8) if –ø–æ–ª–µ[i][j] is not None]
        # –î–æ–ø–æ–ª–Ω—è–µ–º –Ω–æ–≤—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
        while len(–∫–æ–ª–æ–Ω–∫–∞) < 8:
            –∫–æ–ª–æ–Ω–∫–∞.append(random.choice(—Å–∏–º–≤–æ–ª—ã))
        # –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–ª–æ–Ω–∫—É –æ–±—Ä–∞—Ç–Ω–æ
        for i in range(8):
            –ø–æ–ª–µ[i][j] = –∫–æ–ª–æ–Ω–∫–∞[i]

def —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å_–±–æ–Ω—É—Å(–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: int, –∫–æ–º–±–æ: int) -> int:
    """–†–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–∞ –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –∫–æ–º–±–æ"""
    # –ë–∞–∑–æ–≤—ã–µ –æ—á–∫–∏ –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    –±–∞–∑–æ–≤—ã–µ_–æ—á–∫–∏ = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π * 10
    
    # –ë–æ–Ω—É—Å –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–≤—à–∏—Ö —Ñ—Ä—É–∫—Ç–æ–≤
    –±–æ–Ω—É—Å_–∑–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = 0
    if –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π >= 5:
        –±–æ–Ω—É—Å_–∑–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = 50  # –ë–æ–Ω—É—Å –∑–∞ 5+ —Ñ—Ä—É–∫—Ç–æ–≤
    elif –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π >= 4:
        –±–æ–Ω—É—Å_–∑–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = 20  # –ë–æ–Ω—É—Å –∑–∞ 4 —Ñ—Ä—É–∫—Ç–∞
    
    # –ë–æ–Ω—É—Å –∑–∞ –∫–æ–º–±–æ
    –±–æ–Ω—É—Å_–∑–∞_–∫–æ–º–±–æ = –∫–æ–º–±–æ * 5
    
    # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫–æ–º–±–æ
    –º–Ω–æ–∂–∏—Ç–µ–ª—å_–∫–æ–º–±–æ = 1 + (–∫–æ–º–±–æ * 0.2)
    
    –∏—Ç–æ–≥–æ–≤—ã–µ_–æ—á–∫–∏ = int((–±–∞–∑–æ–≤—ã–µ_–æ—á–∫–∏ + –±–æ–Ω—É—Å_–∑–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ + –±–æ–Ω—É—Å_–∑–∞_–∫–æ–º–±–æ) * –º–Ω–æ–∂–∏—Ç–µ–ª—å_–∫–æ–º–±–æ)
    
    return –∏—Ç–æ–≥–æ–≤—ã–µ_–æ—á–∫–∏

def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Ö–æ–¥_—Ç—Ä–∏_–≤_—Ä—è–¥(–∏–≥—Ä–∞, x, y):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞ –≤ —Ç—Ä–∏ –≤ —Ä—è–¥"""
    if x < 0 or x >= 8 or y < 0 or y >= 8:
        return None, "‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"
    
    # –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É - –æ—Ç–º–µ–Ω—è–µ–º –≤—ã–±–æ—Ä
    if –∏–≥—Ä–∞.get('–≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞') == (x, y):
        –∏–≥—Ä–∞['–≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞'] = None
        markup = —Å–æ–∑–¥–∞—Ç—å_–∫–Ω–æ–ø–∫–∏_—Ç—Ä–∏_–≤_—Ä—è–¥(–∏–≥—Ä–∞['–ø–æ–ª–µ'])
        return markup, "–í—ã–±–æ—Ä –æ—Ç–º–µ–Ω—ë–Ω. –í—ã–±–µ—Ä–∏ –∫–ª–µ—Ç–∫—É –¥–ª—è –æ–±–º–µ–Ω–∞:"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞
    —Å–æ—Å–µ–¥–∏ = []
    for dx, dy in [(0, 1), (0, -1), (1, 0), (-1, 0)]:
        nx, ny = x + dx, y + dy
        if 0 <= nx < 8 and 0 <= ny < 8:
            —Å–æ—Å–µ–¥–∏.append((nx, ny))
    
    if not —Å–æ—Å–µ–¥–∏:
        return None, "‚ö†Ô∏è –ù–µ—Ç —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞"
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É
    –∏–≥—Ä–∞['–≤—ã–±—Ä–∞–Ω–Ω–∞—è_–∫–ª–µ—Ç–∫–∞'] = (x, y)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ö–æ–¥—ã
    markup = —Å–æ–∑–¥–∞—Ç—å_–∫–Ω–æ–ø–∫–∏_—Ç—Ä–∏_–≤_—Ä—è–¥_—Å_–≤—ã–±–æ—Ä–æ–º(–∏–≥—Ä–∞['–ø–æ–ª–µ'], x, y, —Å–æ—Å–µ–¥–∏)
    return markup, f"–í—ã–±–µ—Ä–∏ —Å–æ—Å–µ–¥–Ω—é—é –∫–ª–µ—Ç–∫—É –¥–ª—è –æ–±–º–µ–Ω–∞ —Å ({x},{y}):"

def —Å–æ–∑–¥–∞—Ç—å_–∫–Ω–æ–ø–∫–∏_—Ç—Ä–∏_–≤_—Ä—è–¥_—Å_–≤—ã–±–æ—Ä–æ–º(–ø–æ–ª–µ, x, y, —Å–æ—Å–µ–¥–∏):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–∏ –∏ —Å–æ—Å–µ–¥–µ–π"""
    import telebot
    markup = telebot.types.InlineKeyboardMarkup(row_width=8)
    
    for i in range(8):
        row = []
        for j in range(8):
            —Å–∏–º–≤–æ–ª = –ø–æ–ª–µ[i][j]
            
            # –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É –∏ —Å–æ—Å–µ–¥–µ–π, —Å–æ—Ö—Ä–∞–Ω—è—è —Ä–∞–∑–º–µ—Ä
            if (i, j) == (x, y):
                text = "‚Ä¢"  # –ú–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            elif (i, j) in —Å–æ—Å–µ–¥–∏:
                text = "¬∑"  # –ú–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            else:
                text = —Å–∏–º–≤–æ–ª
            
            row.append(telebot.types.InlineKeyboardButton(text, callback_data=f"match_{i}_{j}"))
        markup.row(*row)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    control_row = []
    control_row.append(telebot.types.InlineKeyboardButton("üîÑ –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä", callback_data="match_cancel"))
    control_row.append(telebot.types.InlineKeyboardButton("‚èπÔ∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É", callback_data="match_end"))
    markup.row(*control_row)
    
    return markup

def –æ–±–º–µ–Ω_–∫–ª–µ—Ç–æ–∫(–∏–≥—Ä–∞, x1, y1, x2, y2):
    """–û–±–º–µ–Ω –¥–≤—É—Ö –∫–ª–µ—Ç–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –±–æ–Ω—É—Å–æ–≤"""
    –ø–æ–ª–µ = –∏–≥—Ä–∞['–ø–æ–ª–µ']
    
    # –û–±–º–µ–Ω–∏–≤–∞–µ–º –∫–ª–µ—Ç–∫–∏
    –ø–æ–ª–µ[x1][y1], –ø–æ–ª–µ[x2][y2] = –ø–æ–ª–µ[x2][y2], –ø–æ–ª–µ[x1][y1]
    
    # –ò—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
    —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è = –Ω–∞–π—Ç–∏_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ)
    
    if —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–º–±–æ
        –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] += 1
        if –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] > –∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ']:
            –∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ'] = –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ']
        
        # –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ –ø–∞–¥–µ–Ω–∏–µ
        —É–¥–∞–ª–∏—Ç—å_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ, —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–æ–Ω—É—Å
        –æ—á–∫–∏ = —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å_–±–æ–Ω—É—Å(len(—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è), –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'])
        –∏–≥—Ä–∞['—Å—á—ë—Ç'] += –æ—á–∫–∏
        –∏–≥—Ä–∞['—Ö–æ–¥—ã'] += 1
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è
        –Ω–æ–≤—ã–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è = –Ω–∞–π—Ç–∏_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ)
        while –Ω–æ–≤—ã–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–º–±–æ –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] += 1
            if –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] > –∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ']:
                –∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ'] = –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ']
            
            —É–¥–∞–ª–∏—Ç—å_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ, –Ω–æ–≤—ã–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
            –æ—á–∫–∏ = —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å_–±–æ–Ω—É—Å(len(–Ω–æ–≤—ã–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è), –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'])
            –∏–≥—Ä–∞['—Å—á—ë—Ç'] += –æ—á–∫–∏
            –Ω–æ–≤—ã–µ_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è = –Ω–∞–π—Ç–∏_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ)
        
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–º–±–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–∞—Å–∫–∞–¥–∞
        –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] = 0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ö–æ–¥—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
        if not –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–¥–æ—Å—Ç—É–ø–Ω—ã–µ_—Ö–æ–¥—ã(–ø–æ–ª–µ):
            –ø–µ—Ä–µ—Ç–∞—Å–æ–≤–∞—Ç—å_–ø–æ–ª–µ(–ø–æ–ª–µ)
            return True, f"üí• –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ! +{–æ—á–∫–∏} –æ—á–∫–æ–≤\n–°—á—ë—Ç: {–∏–≥—Ä–∞['—Å—á—ë—Ç']}\nüîÑ –ù–µ—Ç —Ö–æ–¥–æ–≤ - –ø–æ–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–æ–≤–∞–Ω–æ!"
        
        return True, f"üí• –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ! +{–æ—á–∫–∏} –æ—á–∫–æ–≤\n–°—á—ë—Ç: {–∏–≥—Ä–∞['—Å—á—ë—Ç']}"
    else:
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        –ø–æ–ª–µ[x1][y1], –ø–æ–ª–µ[x2][y2] = –ø–æ–ª–µ[x2][y2], –ø–æ–ª–µ[x1][y1]
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–º–±–æ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Ö–æ–¥–µ
        –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] = 0
        return False, "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π —Ö–æ–¥."

def —Å–æ–∑–¥–∞—Ç—å_—Ç–µ–∫—Å—Ç_–∏–≥—Ä—ã(–∏–≥—Ä–∞):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä—ã"""
    –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = ""
    if –∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ'] > 0:
        –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = f"\nüî• –ö–æ–º–±–æ: x{–∏–≥—Ä–∞['—Ç–µ–∫—É—â–µ–µ_–∫–æ–º–±–æ']}"
    
    return f"üéØ –¢—Ä–∏ –≤ —Ä—è–¥!\n–°—á—ë—Ç: {–∏–≥—Ä–∞['—Å—á—ë—Ç']}\n–•–æ–¥—ã: {–∏–≥—Ä–∞['—Ö–æ–¥—ã']}{–∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç}"

def —Å–æ–∑–¥–∞—Ç—å_—Ç–µ–∫—Å—Ç_—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞(–∏–≥—Ä–∞):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã"""
    –≤—Ä–µ–º—è_–∏–≥—Ä—ã = int(time.time() - –∏–≥—Ä–∞['–≤—Ä–µ–º—è_–Ω–∞—á–∞–ª–∞'])
    –∏–≥—Ä–∞['–æ–±—â–µ–µ_–≤—Ä–µ–º—è'] = –≤—Ä–µ–º—è_–∏–≥—Ä—ã
    
    —Ä–µ–∫–æ—Ä–¥ = ""
    if –∏–≥—Ä–∞['—Å—á—ë—Ç'] > –∏–≥—Ä–∞.get('–ª—É—á—à–∏–π_—Å—á—ë—Ç', 0):
        —Ä–µ–∫–æ—Ä–¥ = "\nüèÜ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!"
        –∏–≥—Ä–∞['–ª—É—á—à–∏–π_—Å—á—ë—Ç'] = –∏–≥—Ä–∞['—Å—á—ë—Ç']
    
    –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = ""
    if –∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ'] > 1:
        –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = f"\nüî• –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–º–±–æ: x{–∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ']}"
    
    return f"üéÆ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n" \
           f"üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n" \
           f"‚Ä¢ –°—á—ë—Ç: {–∏–≥—Ä–∞['—Å—á—ë—Ç']}\n" \
           f"‚Ä¢ –•–æ–¥—ã: {–∏–≥—Ä–∞['—Ö–æ–¥—ã']}\n" \
           f"‚Ä¢ –í—Ä–µ–º—è: {–≤—Ä–µ–º—è_–∏–≥—Ä—ã} —Å–µ–∫{–∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç}{—Ä–µ–∫–æ—Ä–¥}"

def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–¥–æ—Å—Ç—É–ø–Ω—ã–µ_—Ö–æ–¥—ã(–ø–æ–ª–µ):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤"""
    for i in range(8):
        for j in range(8):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ–±–º–µ–Ω—ã
            for dx, dy in [(0, 1), (0, -1), (1, 0), (-1, 0)]:
                ni, nj = i + dx, j + dy
                if 0 <= ni < 8 and 0 <= nj < 8:
                    # –ü—Ä–æ–±—É–µ–º –æ–±–º–µ–Ω
                    –ø–æ–ª–µ[i][j], –ø–æ–ª–µ[ni][nj] = –ø–æ–ª–µ[ni][nj], –ø–æ–ª–µ[i][j]
                    —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è = –Ω–∞–π—Ç–∏_—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è(–ø–æ–ª–µ)
                    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    –ø–æ–ª–µ[i][j], –ø–æ–ª–µ[ni][nj] = –ø–æ–ª–µ[ni][nj], –ø–æ–ª–µ[i][j]
                    
                    if —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
                        return True
    return False

def –ø–µ—Ä–µ—Ç–∞—Å–æ–≤–∞—Ç—å_–ø–æ–ª–µ(–ø–æ–ª–µ):
    """–ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞ –ø–æ–ª—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ö–æ–¥–æ–≤ –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π"""
    —Å–∏–º–≤–æ–ª—ã = ["üçé", "üçä", "üçá", "üçì", "üçí", "üçë"]
    
    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    for i in range(8):
        for j in range(8):
            # –í—ã–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª, –∏–∑–±–µ–≥–∞—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            –¥–æ—Å—Ç—É–ø–Ω—ã–µ = —Å–∏–º–≤–æ–ª—ã.copy()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å (2 –Ω–∞–∑–∞–¥)
            if j >= 2 and –ø–æ–ª–µ[i][j-1] == –ø–æ–ª–µ[i][j-2]:
                if –ø–æ–ª–µ[i][j-1] in –¥–æ—Å—Ç—É–ø–Ω—ã–µ:
                    –¥–æ—Å—Ç—É–ø–Ω—ã–µ.remove(–ø–æ–ª–µ[i][j-1])
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å (2 –Ω–∞–∑–∞–¥)
            if i >= 2 and –ø–æ–ª–µ[i-1][j] == –ø–æ–ª–µ[i-2][j]:
                if –ø–æ–ª–µ[i-1][j] in –¥–æ—Å—Ç—É–ø–Ω—ã–µ:
                    –¥–æ—Å—Ç—É–ø–Ω—ã–µ.remove(–ø–æ–ª–µ[i-1][j])
            
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
            —Å–∏–º–≤–æ–ª = random.choice(–¥–æ—Å—Ç—É–ø–Ω—ã–µ)
            –ø–æ–ª–µ[i][j] = —Å–∏–º–≤–æ–ª

def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Ä–µ–∑—É–ª—å—Ç–∞—Ç_–≤_–±–¥(user_id: int, –∏–≥—Ä–∞: dict) -> Tuple[bool, bool, List[str]]:
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    from database import db
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã
    result = db.save_game_result(
        user_id=user_id,
        game_type="—Ç—Ä–∏_–≤_—Ä—è–¥",
        score=–∏–≥—Ä–∞['—Å—á—ë—Ç'],
        moves=–∏–≥—Ä–∞['—Ö–æ–¥—ã'],
        game_time=–∏–≥—Ä–∞['–æ–±—â–µ–µ_–≤—Ä–µ–º—è'],
        max_combo=–∏–≥—Ä–∞['–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ_–∫–æ–º–±–æ']
    )
    
    return result

def –ø–æ–ª—É—á–∏—Ç—å_—Ç–∞–±–ª–∏—Ü—É_–ª–∏–¥–µ—Ä–æ–≤(limit: int = 10) -> List[Tuple]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ –¥–ª—è –∏–≥—Ä—ã —Ç—Ä–∏ –≤ —Ä—è–¥"""
    from database import db
    return db.get_leaderboard("—Ç—Ä–∏_–≤_—Ä—è–¥", limit)

def –ø–æ–ª—É—á–∏—Ç—å_–ø–æ–∑–∏—Ü–∏—é_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(user_id: int) -> Optional[int]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤"""
    from database import db
    return db.get_user_position(user_id, "—Ç—Ä–∏_–≤_—Ä—è–¥")

def —Å–æ–∑–¥–∞—Ç—å_—Ç–µ–∫—Å—Ç_—Ç–∞–±–ª–∏—Ü—ã_–ª–∏–¥–µ—Ä–æ–≤(–ª–∏–¥–µ—Ä—ã: List[Tuple], –ø–æ–∑–∏—Ü–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: Optional[int] = None) -> str:
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤"""
    if not –ª–∏–¥–µ—Ä—ã:
        return "üìä –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø—É—Å—Ç–∞"
    
    —Ç–µ–∫—Å—Ç = "üèÜ **–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ - –¢—Ä–∏ –≤ —Ä—è–¥**\n\n"
    
    for i, (username, first_name, score, moves, game_time, max_combo, created_at) in enumerate(–ª–∏–¥–µ—Ä—ã, 1):
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–º—è –∏–≥—Ä–æ–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ª–æ–≥–∏–Ω–∞
        if username:
            –∏–º—è = f"@{username}"
        elif first_name:
            –∏–º—è = first_name
        else:
            –∏–º—è = "–ê–Ω–æ–Ω–∏–º"
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
        –≤—Ä–µ–º—è_—Ç–µ–∫—Å—Ç = ""
        if game_time:
            –≤—Ä–µ–º—è_—Ç–µ–∫—Å—Ç = f" ‚è±Ô∏è{game_time}—Å"
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–º–±–æ
        –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = ""
        if max_combo and max_combo > 1:
            –∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç = f" üî•x{max_combo}"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è —Ç–æ–ø-3
        –º–µ—Å—Ç–æ_—ç–º–æ–¥–∑–∏ = "ü•á" if i == 1 else "ü•à" if i == 2 else "ü•â" if i == 3 else f"{i}."
        
        —Ç–µ–∫—Å—Ç += f"{–º–µ—Å—Ç–æ_—ç–º–æ–¥–∑–∏} **{–∏–º—è}** - {score} –æ—á–∫–æ–≤ (—Ö–æ–¥–æ–≤: {moves}){–≤—Ä–µ–º—è_—Ç–µ–∫—Å—Ç}{–∫–æ–º–±–æ_—Ç–µ–∫—Å—Ç}\n"
    
    if –ø–æ–∑–∏—Ü–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
        —Ç–µ–∫—Å—Ç += f"\nüìç –¢–≤–æ—è –ø–æ–∑–∏—Ü–∏—è: #{–ø–æ–∑–∏—Ü–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è}"
    
    return —Ç–µ–∫—Å—Ç 